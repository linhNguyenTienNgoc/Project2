<?xml version="1.0" encoding="UTF-8"?>

<!--
Modern Payment Interface FXML
File: src/main/resources/fxml/payment/payment.fxml
-->

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.image.ImageView?>

<BorderPane xmlns="http://javafx.com/javafx/17.0.2-ea" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.cafe.controller.payment.PaymentController"
            stylesheets="@../../css/payment.css"
            prefWidth="1200" prefHeight="750" minWidth="1000" minHeight="650">

    <!-- Header -->
    <top>
        <HBox styleClass="header-container" alignment="CENTER_LEFT" spacing="20">
            <padding>
                <Insets top="20" right="30" bottom="20" left="30"/>
            </padding>
            
            <VBox spacing="5">
                <Label text="💳 Thanh Toán" styleClass="header-title"/>
            </VBox>
            
            <Region HBox.hgrow="ALWAYS"/>
            
            <!-- Order Info Section -->
            <HBox spacing="20" styleClass="order-info-section">
                <VBox spacing="5">
                    <Label text="Mã đơn hàng:" styleClass="info-label"/>
                    <Label fx:id="orderIdLabel" text="ORD-001" styleClass="info-value"/>
                </VBox>
                <VBox spacing="5">
                    <Label text="Bàn:" styleClass="info-label"/>
                    <Label fx:id="tableIdLabel" text="Bàn 1" styleClass="info-value"/>
                </VBox>
                <VBox spacing="5">
                    <Label text="Thời gian:" styleClass="info-label"/>
                    <Label fx:id="orderTimeLabel" text="14:30 19/12/2024" styleClass="info-value"/>
                </VBox>
                <VBox spacing="5">
                    <Label text="Nhân viên:" styleClass="info-label"/>
                    <Label fx:id="serverNameLabel" text="Admin" styleClass="staff-name"/>
                </VBox>
            </HBox>
        </HBox>
    </top>

    <center>
        <HBox styleClass="main-container" spacing="20">
            <padding>
                <Insets top="20" right="20" bottom="20" left="20"/>
            </padding>

            <!-- Left Panel - Shopping Cart -->
            <VBox styleClass="cart-panel" spacing="15" prefWidth="450" minWidth="400" maxWidth="500">
                <VBox spacing="10" VBox.vgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label text="🛒 Giỏ Hàng" styleClass="panel-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="totalItemsLabel" text="0 món" styleClass="item-count"/>
                    </HBox>
                    
                    <!-- Items Table -->
                    <TableView fx:id="itemsTableView" styleClass="cart-table" prefHeight="200" maxHeight="300">
                        <columns>
                            <TableColumn fx:id="sttColumn" text="STT" prefWidth="40" sortable="false"/>
                            <TableColumn fx:id="itemNameColumn" text="Món" prefWidth="180" sortable="false"/>
                            <TableColumn fx:id="quantityColumn" text="SL" prefWidth="50" sortable="false"/>
                            <TableColumn fx:id="unitPriceColumn" text="Đơn giá" prefWidth="80" sortable="false"/>
                            <TableColumn fx:id="totalPriceColumn" text="Thành tiền" prefWidth="100" sortable="false"/>
                        </columns>
                        <placeholder>
                            <Label text="Chưa có món nào trong giỏ hàng" styleClass="empty-cart-message"/>
                        </placeholder>
                    </TableView>
                </VBox>
                
                <!-- Customer Information Section -->
                <VBox spacing="10" styleClass="customer-section">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label text="👤 Thông tin khách hàng (tùy chọn)" styleClass="section-subtitle"/>
                        <Region HBox.hgrow="ALWAYS"/>
                    </HBox>
                    
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <VBox spacing="5">
                            <Label text="Số điện thoại:" styleClass="customer-label"/>
                            <ComboBox fx:id="customerPhoneField" promptText="Nhập SĐT (tùy chọn)..." 
                                     styleClass="customer-input" prefWidth="140" editable="true"/>
                        </VBox>
                        <VBox spacing="5">
                            <Label text="Tên khách hàng:" styleClass="customer-label"/>
                            <TextField fx:id="customerNameField" promptText="Tên khách hàng (tùy chọn)..." 
                                     styleClass="customer-input" prefWidth="180"/>
                        </VBox>
                    </HBox>
                    
                    <Label text="💡 Lưu ý: Có thể thanh toán mà không cần nhập thông tin khách hàng" 
                           styleClass="info-note"/>
                </VBox>
            </VBox>

            <!-- Right Panel - Payment -->
            <VBox styleClass="payment-panel" spacing="15" prefWidth="350" minWidth="320" maxWidth="380">
                
                <!-- Payment Summary -->
                <VBox spacing="15" styleClass="summary-section">
                    <Label text="💰 Tóm Tắt Thanh Toán" styleClass="panel-title"/>
                    
                    <VBox spacing="12" styleClass="summary-details">
                        <HBox styleClass="summary-row">
                            <Label text="Tạm tính" styleClass="summary-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="subtotalLabel" text="0₫" styleClass="summary-value"/>
                        </HBox>
                        
                        <HBox styleClass="summary-row">
                            <Label text="Thuế VAT (8%)" styleClass="summary-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="vatAmountLabel" text="0₫" styleClass="summary-value"/>
                        </HBox>
                        
                        <HBox fx:id="discountRow" styleClass="summary-row discount-row" visible="false" managed="false">
                            <Label text="Giảm giá" styleClass="summary-label discount-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="discountAmountLabel" text="-0₫" styleClass="summary-value discount-value"/>
                        </HBox>
                        
                        <Separator styleClass="summary-separator"/>
                        
                        <HBox styleClass="summary-row total-row">
                            <Label text="TỔNG CỘNG" styleClass="total-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="grandTotalLabel" text="0₫" styleClass="total-value"/>
                        </HBox>
                    </VBox>
                </VBox>

                <!-- Promotion Section -->
                <VBox spacing="15" styleClass="promotion-section">
                    <Label text="🎟️ Khuyến Mãi" styleClass="section-subtitle"/>
                    
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <ComboBox fx:id="promotionComboBox" prefWidth="200" promptText="Chọn khuyến mãi..."/>
                        <Button fx:id="applyPromotionButton" text="Áp dụng" styleClass="promotion-button"/>
                    </HBox>
                    
                    <Label fx:id="appliedPromotionLabel" text="" styleClass="applied-promotion" 
                           visible="false" managed="false"/>
                </VBox>

                <!-- Payment Methods -->
                <VBox spacing="15" styleClass="payment-methods-section">
                    <Label text="💳 Phương Thức Thanh Toán" styleClass="section-subtitle"/>
                    
                    <VBox spacing="10">
                        <fx:define>
                            <ToggleGroup fx:id="paymentMethodGroup"/>
                        </fx:define>
                        
                        <HBox spacing="15">
                            <VBox spacing="8">
                                <RadioButton fx:id="cashRadio" text="💵 Tiền mặt" 
                                           styleClass="payment-method-radio" toggleGroup="$paymentMethodGroup" selected="true"/>
                                <RadioButton fx:id="cardRadio" text="💳 Thẻ tín dụng" 
                                           styleClass="payment-method-radio" toggleGroup="$paymentMethodGroup"/>
                                <RadioButton fx:id="momoRadio" text="📱 MoMo" 
                                           styleClass="payment-method-radio" toggleGroup="$paymentMethodGroup"/>
                            </VBox>
                            <VBox spacing="8">
                                <RadioButton fx:id="vnpayRadio" text="🛒 VNPay" 
                                           styleClass="payment-method-radio" toggleGroup="$paymentMethodGroup"/>
                                <RadioButton fx:id="zalopayRadio" text="💙 ZaloPay" 
                                           styleClass="payment-method-radio" toggleGroup="$paymentMethodGroup"/>
                                <RadioButton fx:id="transferRadio" text="🏦 Chuyển khoản" 
                                           styleClass="payment-method-radio" toggleGroup="$paymentMethodGroup"/>
                            </VBox>
                        </HBox>
                    </VBox>
                </VBox>

                <!-- Cash Payment Details -->
                <VBox fx:id="cashPaymentSection" spacing="15" styleClass="cash-details-section">
                    <Label text="💵 Chi Tiết Thanh Toán Tiền Mặt" styleClass="section-subtitle"/>
                    
                    <VBox spacing="10" styleClass="cash-calculation">
                        <HBox styleClass="cash-row">
                            <Label text="Tổng tiền" styleClass="cash-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="cashTotalLabel" text="0₫" styleClass="cash-value"/>
                        </HBox>
                        
                        <HBox styleClass="cash-row">
                            <Label text="Khách đưa" styleClass="cash-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <TextField fx:id="customerAmountField" text="" styleClass="cash-input" 
                                     promptText="Nhập số tiền..." prefWidth="120" disable="true"/>
                        </HBox>
                        
                        <HBox styleClass="cash-row">
                            <Label text="Tiền thừa" styleClass="cash-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="changeAmountLabel" text="0₫" styleClass="change-value"/>
                        </HBox>
                    </VBox>
                    
                    <Label fx:id="cashErrorLabel" text="" styleClass="error-message" 
                           visible="false" managed="false"/>
                </VBox>

                <!-- QR Code Section (for digital wallets) -->
                <VBox fx:id="qrCodeSection" spacing="15" styleClass="qr-section" 
                      visible="false" managed="false">
                    <Label text="📱 Thanh Toán QR Code" styleClass="section-subtitle"/>
                    
                    <VBox spacing="10" alignment="CENTER">
                        <VBox fx:id="qrCodeContainer" spacing="10" alignment="CENTER">
                            <ImageView fx:id="qrCodeImageView" fitWidth="150" fitHeight="150" 
                                     preserveRatio="true" styleClass="qr-code"/>
                            <Label fx:id="qrCodeInstructionLabel" text="Quét mã QR để thanh toán" styleClass="qr-instruction"/>
                        </VBox>
                        
                        <VBox spacing="8" alignment="CENTER">
                            <Label text="Mã giao dịch (sau khi thanh toán):" styleClass="transaction-label"/>
                            <TextField fx:id="qrTransactionCodeField" promptText="Nhập mã giao dịch..." 
                                     styleClass="transaction-input" prefWidth="200"/>
                        </VBox>
                    </VBox>
                </VBox>

                <!-- Card Payment Section -->
                <VBox fx:id="cardPaymentSection" spacing="15" styleClass="card-section" 
                      visible="false" managed="false">
                    <Label text="💳 Thanh Toán Thẻ" styleClass="section-subtitle"/>
                    
                    <VBox spacing="10" styleClass="card-instructions">
                        <Label text="1. Quét thẻ trên máy POS" styleClass="instruction"/>
                        <Label text="2. Nhập mã PIN nếu được yêu cầu" styleClass="instruction"/>
                        <Label text="3. Bấm 'Thanh toán' để hoàn tất" styleClass="instruction"/>
                        
                        <Label text="💡 Dành cho project học tập - không cần mã giao dịch" 
                               styleClass="instruction" style="-fx-text-fill: #666; -fx-font-style: italic;"/>
                    </VBox>
                </VBox>

                <!-- Legacy Card Transfer Section (for compatibility) -->
                <VBox fx:id="cardTransferSection" spacing="15" styleClass="section" 
                      visible="false" managed="false">
                    <Label text="Thông tin giao dịch" styleClass="section-subtitle"/>
                    <VBox spacing="10">
                        <VBox spacing="5">
                            <Label text="Ghi chú (tùy chọn):"/>
                            <TextArea fx:id="paymentNotesArea" prefRowCount="3" wrapText="true" 
                                    promptText="Nhập ghi chú về giao dịch..."/>
                        </VBox>
                    </VBox>
                </VBox>

                <!-- Hidden fields for legacy compatibility -->
                <TextField fx:id="vatPercentField" text="8" visible="false" managed="false"/>
                <RadioButton fx:id="discountPercentRadio" text="Phần trăm" visible="false" managed="false"/>
                <RadioButton fx:id="discountAmountRadio" text="VNĐ" visible="false" managed="false"/>
                <TextField fx:id="discountValueField" text="0" visible="false" managed="false"/>
                <Label fx:id="discountUnitLabel" text="phần trăm" visible="false" managed="false"/>
                <Label fx:id="discountErrorLabel" text="" visible="false" managed="false"/>
            </VBox>
        </HBox>
    </center>

    <!-- Footer -->
    <bottom>
        <HBox styleClass="footer-container" spacing="10" alignment="CENTER_RIGHT">
            <padding>
                <Insets top="15" right="20" bottom="15" left="20"/>
            </padding>
            
            <Button fx:id="printReceiptButton" text="🖨️ In hóa đơn" styleClass="secondary-button" 
                    prefWidth="100" maxWidth="120"/>
            <Button fx:id="cancelButton" text="❌ Hủy" styleClass="cancel-button" 
                    prefWidth="80" maxWidth="100"/>
            <Button fx:id="payButton" text="💰 THANH TOÁN" styleClass="primary-button" 
                    defaultButton="true" prefWidth="120" maxWidth="140"/>
        </HBox>
    </bottom>

</BorderPane>