<?xml version="1.0" encoding="UTF-8"?>

<!--
Enhanced Payment FXML - Auto Cash + QR Code + Promotions
File: src/main/resources/fxml/payment/payment.fxml
-->

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.image.ImageView?>

<BorderPane xmlns="http://javafx.com/javafx/17.0.2-ea" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.cafe.controller.payment.PaymentController"
            stylesheets="@../../css/payment.css">

    <!-- Header -->
   <top>
        <VBox styleClass="payment-header">
         <padding>
                <Insets top="20" right="20" bottom="10" left="20"/>
         </padding>
            
            <Label text="ðŸ’³ THANH TOÃN" styleClass="payment-title">
            <font>
                    <Font name="System Bold" size="24"/>
            </font>
         </Label>
            
            <!-- Order Info -->
            <HBox spacing="20" styleClass="order-info-section">
                <VBox spacing="5">
                    <Label text="MÃ£ Ä‘Æ¡n hÃ ng:" styleClass="info-label"/>
                    <Label fx:id="orderIdLabel" text="ORD-001" styleClass="info-value"/>
                </VBox>
                <VBox spacing="5">
                    <Label text="BÃ n:" styleClass="info-label"/>
                    <Label fx:id="tableIdLabel" text="BÃ n 1" styleClass="info-value"/>
                </VBox>
                <VBox spacing="5">
                    <Label text="NhÃ¢n viÃªn:" styleClass="info-label"/>
                    <Label fx:id="serverNameLabel" text="Admin" styleClass="info-value"/>
                </VBox>
                <VBox spacing="5">
                    <Label text="Thá»i gian:" styleClass="info-label"/>
                    <Label fx:id="orderTimeLabel" text="14:30 19/12/2024" styleClass="info-value"/>
                </VBox>
      </HBox>
        </VBox>
   </top>

   <center>
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" styleClass="payment-scroll">
            <VBox spacing="20" styleClass="payment-content">
         <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
         </padding>
         
                <!-- Order Items Table -->
                <VBox spacing="10" styleClass="section">
                    <Label text="ðŸ“‹ Chi tiáº¿t Ä‘Æ¡n hÃ ng" styleClass="section-title"/>
                    <TableView fx:id="itemsTableView" styleClass="order-table" prefHeight="200">
                        <columns>
                            <TableColumn fx:id="sttColumn" text="STT" prefWidth="40"/>
                            <TableColumn fx:id="itemNameColumn" text="MÃ³n" prefWidth="200"/>
                            <TableColumn fx:id="quantityColumn" text="SL" prefWidth="60"/>
                            <TableColumn fx:id="unitPriceColumn" text="ÄÆ¡n giÃ¡" prefWidth="100"/>
                            <TableColumn fx:id="totalPriceColumn" text="ThÃ nh tiá»n" prefWidth="120"/>
                        </columns>
                    </TableView>
                    <Label fx:id="totalItemsLabel" text="Tá»•ng: 0 mÃ³n" styleClass="total-items"/>
                </VBox>

                <!-- âœ… ENHANCED: Promotion Section (Replace manual discount) -->
                <VBox spacing="15" styleClass="section">
                    <Label text="ðŸŽŸï¸ Khuyáº¿n mÃ£i" styleClass="section-title"/>
                    
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <ComboBox fx:id="promotionComboBox" prefWidth="300" promptText="Chá»n khuyáº¿n mÃ£i..."/>
                        <Button fx:id="applyPromotionButton" text="Ãp dá»¥ng" styleClass="promotion-button"/>
                    </HBox>
                    
                    <Label fx:id="appliedPromotionLabel" text="ÄÃ£ Ã¡p dá»¥ng: Giáº£m 10 pháº§n trÄƒm" 
                           styleClass="applied-promotion" visible="false"/>
                    
                    <!-- Legacy discount section for backward compatibility -->
                    <VBox spacing="10" visible="false" managed="false">
                        <fx:define>
                            <ToggleGroup fx:id="discountTypeGroup"/>
                        </fx:define>
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="Loáº¡i giáº£m giÃ¡:" minWidth="100"/>
                            <RadioButton fx:id="discountPercentRadio" text="Pháº§n trÄƒm" selected="true"/>
                            <RadioButton fx:id="discountAmountRadio" text="VNÄ"/>
                        </HBox>
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="GiÃ¡ trá»‹:" minWidth="100"/>
                            <TextField fx:id="discountValueField" text="0" prefWidth="150"/>
                            <Label fx:id="discountUnitLabel" text="pháº§n trÄƒm"/>
                        </HBox>
                        <Label fx:id="discountErrorLabel" styleClass="error-label" text="" visible="false"/>
                    </VBox>
                </VBox>

                <!-- Payment Calculation -->
                <VBox spacing="15" styleClass="section">
                    <Label text="ðŸ’° TÃ­nh toÃ¡n thanh toÃ¡n" styleClass="section-title"/>
                    
                    <GridPane hgap="15" vgap="10" styleClass="calculation-grid">
                  <columnConstraints>
                            <ColumnConstraints hgrow="ALWAYS"/>
                            <ColumnConstraints hgrow="NEVER" prefWidth="120"/>
                  </columnConstraints>

                        <!-- Subtotal -->
                        <Label text="Táº¡m tÃ­nh:" styleClass="calc-label" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                        <Label fx:id="subtotalLabel" text="0 â‚«" styleClass="calc-value" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                        <!-- VAT (Fixed 8%) -->
                        <Label text="Thuáº¿ VAT (8 pháº§n trÄƒm):" styleClass="calc-label" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                        <Label fx:id="vatAmountLabel" text="0 â‚«" styleClass="calc-value" GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                        
                        <!-- âœ… HIDDEN: VAT input field (read-only) -->
                        <TextField fx:id="vatPercentField" text="8" disable="true" visible="false" managed="false"/>

                        <!-- Discount -->
                        <Label text="Giáº£m giÃ¡:" styleClass="calc-label" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                        <Label fx:id="discountAmountLabel" text="- 0 â‚«" styleClass="discount-value" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                        <!-- Grand Total -->
                        <Separator GridPane.columnIndex="0" GridPane.rowIndex="3" GridPane.columnSpan="2"/>
                        <Label text="Tá»”NG Cá»˜NG:" styleClass="grand-total-label" GridPane.columnIndex="0" GridPane.rowIndex="4"/>
                        <Label fx:id="grandTotalLabel" text="0 â‚«" styleClass="grand-total-value" GridPane.columnIndex="1" GridPane.rowIndex="4"/>
               </GridPane>
            </VBox>
            
                <!-- Payment Methods -->
                <VBox spacing="15" styleClass="section">
                    <Label text="ðŸ’³ PhÆ°Æ¡ng thá»©c thanh toÃ¡n" styleClass="section-title"/>
                    
                    <VBox spacing="10">
                        <fx:define>
                            <ToggleGroup fx:id="paymentMethodGroup"/>
                        </fx:define>
                        
                        <!-- Payment method options -->
                        <HBox spacing="20">
                            <VBox spacing="8">
                                <RadioButton fx:id="cashRadio" text="ðŸ’µ Tiá»n máº·t" styleClass="payment-method" 
                                           selected="true"/>
                                <RadioButton fx:id="cardRadio" text="ðŸ’³ Tháº» tÃ­n dá»¥ng/ghi ná»£" styleClass="payment-method"/>
                                <RadioButton fx:id="momoRadio" text="ðŸ“± VÃ­ MoMo" styleClass="payment-method"/>
                            </VBox>
                            <VBox spacing="8">
                                <RadioButton fx:id="vnpayRadio" text="ðŸ›ï¸ VNPay" styleClass="payment-method"/>
                                <RadioButton fx:id="zalopayRadio" text="ðŸ’™ ZaloPay" styleClass="payment-method"/>
                                <RadioButton fx:id="transferRadio" text="ðŸ¦ Chuyá»ƒn khoáº£n" styleClass="payment-method"/>
                            </VBox>
               </HBox>
            </VBox>
         </VBox>
         
                <!-- âœ… ENHANCED: Cash Payment Section (Auto-fill) -->
                <VBox fx:id="cashPaymentSection" spacing="15" styleClass="section payment-section">
                    <Label text="ðŸ’µ Thanh toÃ¡n tiá»n máº·t" styleClass="section-title"/>
                    
                    <GridPane hgap="15" vgap="10">
                        <columnConstraints>
                            <ColumnConstraints hgrow="ALWAYS"/>
                            <ColumnConstraints hgrow="NEVER" prefWidth="120"/>
                        </columnConstraints>

                        <Label text="Tá»•ng tiá»n:" styleClass="cash-label" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                        <Label fx:id="cashTotalLabel" text="0 â‚«" styleClass="cash-total" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                        <Label text="KhÃ¡ch Ä‘Æ°a:" styleClass="cash-label" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                        <TextField fx:id="customerAmountField" text="0" styleClass="cash-amount" 
                                 disable="true" promptText="Tá»± Ä‘á»™ng" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                        <Label text="Tiá»n thá»«a:" styleClass="cash-label" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                        <Label fx:id="changeAmountLabel" text="0 â‚«" styleClass="change-amount" GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                    </GridPane>
                    
                    <!-- Legacy error label -->
                    <Label fx:id="cashErrorLabel" styleClass="error-label" text="" visible="false"/>
               </VBox>
               
                <!-- âœ… ENHANCED: Card Payment Section -->
                <VBox fx:id="cardPaymentSection" spacing="15" styleClass="section payment-section" 
                      visible="false" managed="false">
                    <Label text="ðŸ’³ Thanh toÃ¡n tháº» tÃ­n dá»¥ng/ghi ná»£" styleClass="section-title"/>
                    
                    <VBox spacing="15">
                        <Label text="1. Vui lÃ²ng quáº¹t tháº» trÃªn mÃ¡y POS" styleClass="instruction-text"/>
                        <Label text="2. Nháº­p mÃ£ PIN náº¿u Ä‘Æ°á»£c yÃªu cáº§u" styleClass="instruction-text"/>
                        <Label text="3. Chá» xÃ¡c nháº­n giao dá»‹ch thÃ nh cÃ´ng" styleClass="instruction-text"/>
                        
                        <VBox spacing="5">
                            <Label text="MÃ£ giao dá»‹ch tá»« mÃ¡y POS:" styleClass="field-label"/>
                            <TextField fx:id="transactionCodeField" promptText="Nháº­p mÃ£ giao dá»‹ch tá»« mÃ¡y POS..." 
                                     styleClass="transaction-code-field" prefWidth="350"/>
                        </VBox>
                        
                        <Label text="ðŸ’¡ MÃ£ giao dá»‹ch sáº½ hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh mÃ¡y POS sau khi thanh toÃ¡n thÃ nh cÃ´ng" 
                               styleClass="hint-text" wrapText="true"/>
                    </VBox>
                </VBox>
            
                <!-- âœ… ENHANCED: QR Code Payment Section -->
                <VBox fx:id="qrCodeSection" spacing="15" styleClass="section payment-section" 
                      visible="false" managed="false">
                    <Label text="ðŸ“± Thanh toÃ¡n QR Code" styleClass="section-title"/>
                    
                    <HBox spacing="20" alignment="CENTER">
                        <!-- QR Code Container -->
                        <VBox fx:id="qrCodeContainer" spacing="10" alignment="CENTER" prefWidth="250">
                            <ImageView fx:id="qrCodeImageView" fitWidth="200" fitHeight="200" 
                                     preserveRatio="true" styleClass="qr-code-image"/>
                            <Label fx:id="qrCodeInstructionLabel" text="QuÃ©t mÃ£ QR Ä‘á»ƒ thanh toÃ¡n" 
                                   styleClass="qr-instruction" textAlignment="CENTER" wrapText="true" maxWidth="220"/>
                        </VBox>
               
                        <!-- Transaction input -->
                        <VBox spacing="10" prefWidth="300">
                            <Label text="Sau khi thanh toÃ¡n thÃ nh cÃ´ng:" styleClass="instruction-text" wrapText="true"/>
                            <VBox spacing="5">
                                <Label text="MÃ£ giao dá»‹ch:" styleClass="field-label"/>
                                <TextField fx:id="qrTransactionCodeField" promptText="Nháº­p mÃ£ giao dá»‹ch..." 
                                         styleClass="transaction-code-field" prefWidth="280"/>
                            </VBox>
                            <Label text="ðŸ’¡ MÃ£ giao dá»‹ch thÆ°á»ng cÃ³ 6-12 kÃ½ tá»±" styleClass="hint-text"/>
                        </VBox>
                    </HBox>
                </VBox>
               
                <!-- Legacy card/transfer section for compatibility -->
                <VBox fx:id="cardTransferSection" spacing="15" styleClass="section" 
                      visible="false" managed="false">
                    <Label text="ThÃ´ng tin giao dá»‹ch" styleClass="section-title"/>
                    <VBox spacing="10">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="MÃ£ giao dá»‹ch:" minWidth="100"/>
                            <TextField fx:id="transactionCodeField" prefWidth="200" promptText="Nháº­p mÃ£ giao dá»‹ch..."/>
                  </HBox>
                        <VBox spacing="5">
                            <Label text="Ghi chÃº (tÃ¹y chá»n):"/>
                            <TextArea fx:id="paymentNotesArea" prefRowCount="3" wrapText="true" 
                                    promptText="Nháº­p ghi chÃº vá» giao dá»‹ch..."/>
                  </VBox>
               </VBox>
            </VBox>

            </VBox>
         </ScrollPane>
   </center>
   
    <!-- Footer Buttons -->
   <bottom>
        <HBox spacing="15" alignment="CENTER_RIGHT" styleClass="button-section">
         <padding>
                <Insets top="20" right="20" bottom="20" left="20"/>
         </padding>
            
            <Button fx:id="printReceiptButton" text="ðŸ–¨ï¸ In hÃ³a Ä‘Æ¡n" styleClass="secondary-button"/>
            <Button fx:id="cancelButton" text="âŒ Há»§y" styleClass="cancel-button"/>
            <Button fx:id="payButton" text="ðŸ’° THANH TOÃN" styleClass="primary-button" defaultButton="true">
            <font>
                    <Font name="System Bold" size="14"/>
            </font>
         </Button>
      </HBox>
   </bottom>

</BorderPane>